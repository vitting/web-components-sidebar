<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="cvn-sidebar-style.html">

<dom-module id="cvn-sidebar">
  <template>
    <style include="sidebar-style">
      @keyframes slideOut {
        from {
          transform: translateX(0);
        }
        to {
          transform: translateX(-230px);
        }
      }

      @keyframes slideIn {
        from {
          transform: translateX(-230px);
        }
        to {
          transform: translateX(0);
        }
      }

      :host {
        display: block;
      }

      #cvnSidebarContainer {
        position: fixed;
        top: 0;
        left: 0;
        box-sizing: border-box;
        height: 100vh;
        width: 200px;
        padding: 10px 10px 10px 20px; 
        font-family: Arial, Helvetica, sans-serif;
        display: none;
      }

      #cvnSidebarClose {
        border-style: none;
        border-radius: 50%;
        line-height: 1em;
        padding: 0;
        width: 40px;
        height: 40px;
        font-size: 2.5em;
        color: white;
        cursor: pointer;
        outline: none;
      }

      header {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
        margin-bottom: 20px;
        margin-right: 10px;
      }
    </style>
    <div id="cvnSidebarContainer" class="bgcolor-primary-0">
      <header>
        <button id="cvnSidebarClose" class="bgcolor-primary-3 hover-bgcolor-primary-1" type="button" on-click="_closeSidebar">&times;</button>
      </header>  
      <div id="cvnSidebarMenuItems">
        <slot></slot>        
      </div>
    </div>
  </template>

  <script>
    class CvnSidebar extends Polymer.Element {
      static get is() { return 'cvn-sidebar'; }
      static get properties() {
        return {
          show: {
            type: String,
            value: "false",
            reflectToAttribute: true,
            observer: "_openHideSidebar"
          }
        };
      }

      ready() {
        super.ready();
        
        this.$.cvnSidebarContainer.addEventListener("animationend", this._sendEvents.bind(this));
      }

      _sendEvents() {
        if (this.show === "false") {  
          this.dispatchEvent(new CustomEvent("sidebar-closed"));
          //this.$.cvnSidebarContainer.style.display = "none";
        } else if (this.show === "true") {
          this.dispatchEvent(new CustomEvent("sidebar-open"));
        }
      }

      _closeSidebar() {
        this.dispatchEvent(new CustomEvent("sidebar-closing"));
        this.$.cvnSidebarContainer.style.animation = "slideOut 500ms ease-in 0s 1 forwards";
        this.show = "false";
      }

      _openSidebar() {        
        this.dispatchEvent(new CustomEvent("sidebar-opening"));
        this.$.cvnSidebarContainer.style.display = "block";
        this.$.cvnSidebarContainer.style.animation = "slideIn 500ms ease-in 0s 1 forwards";
        this.show = "true";
      }

      _openHideSidebar(newValue, oldValue) {
        if (oldValue) {
          if (newValue === "true") {
            this._openSidebar();
          } else if (newValue === "false") {
            this._closeSidebar();
          }
        } else { //Init
          if (newValue === "true") {
            this.$.cvnSidebarContainer.style.display = "block";
          } else if (newValue === "false") {
            this.$.cvnSidebarContainer.style.display = "none";
          }
        }
      }
    }

    window.customElements.define(CvnSidebar.is, CvnSidebar);
  </script>
</dom-module>
